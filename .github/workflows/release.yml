name: Release

on:
  release:
    types: [published]

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.11
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements_test.txt
    
    - name: Run full test suite
      env:
        PYTHONPATH: .
      run: |
        pytest tests/ \
          --cov=custom_components.everhome \
          --cov-report=xml \
          --cov-fail-under=85
    
    - name: Validate with HACS
      uses: hacs/action@main
      with:
        category: integration
        ignore: brands
    
    - name: Validate with Hassfest
      uses: home-assistant/actions/hassfest@master